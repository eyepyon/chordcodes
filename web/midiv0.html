<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web MIDI Controller - Simple Version</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .midi-log {
            background: #1a1a1a;
            color: #00ff00;
            font-family: monospace;
            padding: 10px;
            border-radius: 5px;
            height: 150px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéπ Web MIDI Controller - Simple</h1>
        
        <div id="status" class="status">Web MIDI API„Çí„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...</div>
        
        <div class="controls">
            <button id="connectBtn">MIDIÊ©üÂô®„Å´Êé•Á∂ö</button>
            <button id="testBtn" disabled>„ÉÜ„Çπ„ÉàÈü≥ (C4)</button>
        </div>
        
        <div id="midiLog" class="midi-log">MIDI „É≠„Ç∞...\n</div>
    </div>

    <script>
        class SimpleMIDIController {
            constructor() {
                this.midiAccess = null;
                this.outputDevice = null;
                
                this.init();
            }
            
            init() {
                this.statusEl = document.getElementById('status');
                this.connectBtn = document.getElementById('connectBtn');
                this.testBtn = document.getElementById('testBtn');
                this.midiLogEl = document.getElementById('midiLog');
                
                this.connectBtn.addEventListener('click', () => this.requestMIDIAccess());
                this.testBtn.addEventListener('click', () => this.playTestNote());
                
                this.checkMIDISupport();
            }
            
            checkMIDISupport() {
                if (navigator.requestMIDIAccess) {
                    this.showStatus('Web MIDI API„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åô', 'success');
                } else {
                    this.showStatus('„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØWeb MIDI API„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇChrome„Åæ„Åü„ÅØEdge„Çí‰ΩøÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
                }
            }
            
            async requestMIDIAccess() {
                try {
                    this.showStatus('MIDIÊ©üÂô®„Å´„Ç¢„ÇØ„Çª„Çπ‰∏≠...', 'info');
                    this.midiAccess = await navigator.requestMIDIAccess();
                    this.setupMIDI();
                    this.showStatus('MIDIÊ©üÂô®„Å´Êé•Á∂ö„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
                } catch (error) {
                    this.showStatus(`MIDIÊé•Á∂ö„Ç®„É©„Éº: ${error.message}`, 'error');
                    this.log(`Error: ${error.message}`);
                }
            }
            
            setupMIDI() {
                this.testBtn.disabled = false;
                
                // ÊúÄÂàù„ÅÆÂá∫Âäõ„Éá„Éê„Ç§„Çπ„ÇíËá™ÂãïÈÅ∏Êäû
                for (const output of this.midiAccess.outputs.values()) {
                    this.outputDevice = output;
                    this.log(`Âá∫ÂäõÊ©üÂô®ÈÅ∏Êäû: ${output.name}`);
                    break;
                }
                
                if (!this.outputDevice) {
                    this.log('Âá∫ÂäõÂèØËÉΩ„Å™MIDIÊ©üÂô®„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                }
            }
            
            playTestNote() {
                if (!this.outputDevice) {
                    this.log('Âá∫ÂäõÊ©üÂô®„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return;
                }
                
                const noteNumber = 60; // C4
                const velocity = 100;
                
                // Note On
                const noteOnMessage = [0x90, noteNumber, velocity];
                this.outputDevice.send(noteOnMessage);
                this.log(`Note On: ${noteNumber} velocity: ${velocity}`);
                
                // 500msÂæå„Å´Note Off
                setTimeout(() => {
                    const noteOffMessage = [0x80, noteNumber, 0];
                    this.outputDevice.send(noteOffMessage);
                    this.log(`Note Off: ${noteNumber}`);
                }, 500);
            }
            
            showStatus(message, type = 'info') {
                this.statusEl.textContent = message;
                this.statusEl.className = `status ${type}`;
            }
            
            log(message) {
                const timestamp = new Date().toLocaleTimeString();
                this.midiLogEl.textContent += `[${timestamp}] ${message}\n`;
                this.midiLogEl.scrollTop = this.midiLogEl.scrollHeight;
            }
        }
        
        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÈñãÂßã
        document.addEventListener('DOMContentLoaded', () => {
            new SimpleMIDIController();
        });
    </script>
</body>
</html>